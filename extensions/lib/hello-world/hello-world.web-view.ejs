<!DOCTYPE html>
<html>
  <head>
    <style>
      .title {
        color: darkgreen;
      }
    </style>
  </head>
  <body>
    <div class="title">Hello World!!</div>
    <div><button id="echo-renderer" type="button">Echo Renderer</button></div>
    <div id="echo-renderer-output"></div>
    <div><button id="hello-someone" type="button">Hello Someone</button></div>
    <div id="hello-someone-output"></div>
    <div id="root"></div>
    <!-- Test the papi-extension protocol in a webView -->
    <img
      src="papi-extension://quick-verse/letter-q.png"
      alt="Q icon"
      style="max-height: 25px; max-width: 25px"
    />
    <script>
      // Test React component to render in the root
      const { createElement, useCallback, useState } = React;
      const {
        react: {
          hooks: { usePromise },
          components: { Button },
        },
        logger,
      } = papi;

      const NAME = 'Hello World React WebView in HTML';

      // Test fetching
      papi
        .fetch('https://bible-api.com/matthew+24:14')
        .then((res) => res.json())
        .then((scr) => logger.info(scr.text.replace(/\\n/g, '')))
        .catch((e) => logger.error(`Could not get Scripture from bible-api! Reason: ${e}`));

      function HelloWorld() {
        const [myState, setMyState] = useState(0);

        const [echoResult] = usePromise(
          useCallback(async () => {
            await new Promise((resolve) => setTimeout(() => resolve(), 3000));
            return papi.commands.sendCommand('echoRenderer', `From ${NAME}`);
          }, []),
          'retrieving',
        );

        return createElement(
          'div',
          null,
          createElement(
            'div',
            null,
            createElement(
              Button,
              {
                onClick: () => {
                  logger.info(`${NAME} Button clicked!`);
                  setMyState((myStateCurrent) => myStateCurrent + 1);
                },
              },
              'Hello World Button ',
              myState,
            ),
          ),
          createElement('div', null, echoResult),
        );
      }

      function print(input) {
        papi.logger.info(input);
      }
      document.addEventListener('DOMContentLoaded', function () {
        // Attach handler for echo-renderer
        const echoRendererButton = document.getElementById('echo-renderer');
        echoRendererButton.addEventListener('click', () =>
          papi.commands.sendCommand('echoRenderer', 'From Hello World WebView').then((message) => {
            const echoRendererOutput = document.getElementById('echo-renderer-output');
            echoRendererOutput.textContent = papi.util.htmlEncode(message);
            print(message);
          }),
        );
        echoRendererButton.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          const promises = new Array(10000);
          for (let i = 0; i < 10000; i += 1)
            promises[i] = papi.commands.sendCommand('echoRenderer', 'From Hello World WebView');
          Promise.all(promises).then(() => print('Done'));
        });

        // Attach handler for hello-someone
        const helloSomeoneButton = document.getElementById('hello-someone');
        helloSomeoneButton.addEventListener('click', () =>
          papi.commands
            .sendCommand('hello-someone.hello-someone', "'Hello World WebView'")
            .then((message) => {
              const helloSomeoneOutput = document.getElementById('hello-someone-output');
              helloSomeoneOutput.textContent = papi.util.htmlEncode(message);
              print(message);
            }),
        );
        helloSomeoneButton.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          const promises = new Array(10000);
          for (let i = 0; i < 10000; i += 1)
            promises[i] = papi.commands.sendCommand(
              'hello-someone.hello-someone',
              "'Hello World WebView'",
            );
          Promise.all(promises).then(() => print('Done'));
        });

        // Initialize React
        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(React.createElement(HelloWorld, null));

        // Test fetching
        papi
          .fetch('https://bible-api.com/matthew+24:14')
          .then((res) => res.json())
          .then((scr) => logger.info(scr.text.replace(/\\n/g, '')))
          .catch((e) => logger.error(`Could not get Scripture from bible-api! Reason: ${e}`));
      });

      //# sourceURL=hello-world-webview.js
    </script>
  </body>
</html>
